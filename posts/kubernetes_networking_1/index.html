<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Kubernetes networking | Network Namespace, veth and bridge - zhengxin</title><link rel=icon type=image/png href=https://raw.githubusercontent.com/zhengxinzx/images/main/20240303214631.png><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="This post will explain the fundamental concepts involved in Kubernetes networking, including network namespace, veth, and bridge."><meta property="og:image" content="https://raw.githubusercontent.com/zhengxinzx/images/main/20240303214631.png"><meta property="og:title" content="Kubernetes networking | Network Namespace, veth and bridge"><meta property="og:description" content="This post will explain the fundamental concepts involved in Kubernetes networking, including network namespace, veth, and bridge."><meta property="og:type" content="article"><meta property="og:url" content="https://zhengxin.online/posts/kubernetes_networking_1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-06T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-06T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Kubernetes networking | Network Namespace, veth and bridge"><meta name=twitter:description content="This post will explain the fundamental concepts involved in Kubernetes networking, including network namespace, veth, and bridge."><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://zhengxin.online/css/main.49cd757e8798937596a4b43c026a3fd1ba67aecebbe47d3940a4349b709dd62c.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://zhengxin.online/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css disabled></head><body><div class=content><header><div class=main><a href=https://zhengxin.online/>zhengxin</a></div><nav><a href=/>Home</a>
<a href=/posts>Blogs</a>
<a href=/tags>Tags</a>
| <span id=dark-mode-toggle onclick=toggleTheme()></span>
<script src=https://zhengxin.online/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>Kubernetes networking | Network Namespace, veth and bridge</h1><div class=meta>Posted on Apr 6, 2024</div></div><section class=body><p>Kubernetes guarantees that each pod in the cluster has a unique IP address, and they can can communicate with each other using this IP address directly. You may wonder how this is achieved. We will have a series of posts that will explain how networking works in Kubernetes. And this is the first post in the series, which will explain three fundamental concepts: network namespace, veth, and bridge, that are the building blocks of Kubernetes (and container) networking.</p><p><em>In this post, we limit the discussion to the Linux networking, without considering the networking in other operating systems.</em></p><h2 id=what-are-network-namespaces>What are network namespaces?</h2><p>Linux provides a feature called namespace. A namespace is a way to isolate resources in the system. For example, a process in one namespace cannot see the processes in another namespace. Linux provides several types of namespaces, such as PID namespace, mount namespace, network namespace, etc.</p><p>As described in <a href=https://man7.org/linux/man-pages/man7/network_namespaces.7.html>network_namespaces(7)</a>,</p><blockquote><p>Network namespaces provide isolation of the system resources associated with networking: network devices, IPv4 and IPv6 protocol stacks, IP routing tables, firewall rules, the /proc/net directory (which is a symbolic link to /proc/pid/net), the /sys/class/net directory, various files under /proc/sys/net, port numbers (sockets), and so on. In addition, network namespaces isolate the UNIX domain abstract socket namespace (see unix(7)).</p></blockquote><p>There is one default network namespace in the system, where processes created without specifying a network namespace will be placed.</p><p>We can create a network namespace using the <code>ip</code> command in <code>iproute2</code> package. For example, the following command creates 2 network namespace named <code>ns1</code> and <code>ns2</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#888;font-style:italic># Create a network namespace named ns1</span>
</span></span><span style=display:flex><span>$ sudo ip netns add ns1
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># Create a network namespace named ns2</span>
</span></span><span style=display:flex><span>$ sudo ip netns add ns2
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># List the network namespaces</span>
</span></span><span style=display:flex><span>$ sudo ip netns list
</span></span><span style=display:flex><span>ns2
</span></span><span style=display:flex><span>ns1
</span></span></code></pre></div><p>Thus there are 3 separate network namespaces in the system now, as shown in figure blow.</p><p><img src=https://raw.githubusercontent.com/zhengxinzx/images/main/picgo20240406224442.png alt=20240406224442></p><p>This can be verified by checking the network interface devices in each network namespace:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#888;font-style:italic># List the network interfaces in the default network namespace</span>
</span></span><span style=display:flex><span>$ sudo ip link show
</span></span><span style=display:flex><span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style=color:#444>65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span style=color:#444>1000</span>
</span></span><span style=display:flex><span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span style=display:flex><span>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style=color:#444>1500</span> qdisc mq state UP mode DEFAULT group default qlen <span style=color:#444>1000</span>
</span></span><span style=display:flex><span>    link/ether 00:15:5d:47:1d:09 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># List the network interfaces in the network namespace ns1</span>
</span></span><span style=display:flex><span>$ sudo ip netns <span style=color:#388038>exec</span> ns1 ip link show
</span></span><span style=display:flex><span>1: lo: &lt;LOOPBACK&gt; mtu <span style=color:#444>65536</span> qdisc noop state DOWN mode DEFAULT group default qlen <span style=color:#444>1000</span>
</span></span><span style=display:flex><span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># List the network interfaces in the network namespace ns2</span>
</span></span><span style=display:flex><span>$ sudo ip netns <span style=color:#388038>exec</span> ns2 ip link show
</span></span><span style=display:flex><span>1: lo: &lt;LOOPBACK&gt; mtu <span style=color:#444>65536</span> qdisc noop state DOWN mode DEFAULT group default qlen <span style=color:#444>1000</span>
</span></span><span style=display:flex><span>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span></code></pre></div><blockquote><p>The <code>ip netns exec</code> command is used to execute a command in a network namespace. In the above example, we use <code>ip netns exec ns1 ip link show</code> to list the network interfaces in the network namespace <code>ns1</code>.</p></blockquote><p>As we can see, the network namespace <code>ns1</code> and <code>ns2</code> have only the loopback interface <code>lo</code>, while the default network namespace has both the loopback interface <code>lo</code> and the ethernet interface <code>eth0</code>.</p><h2 id=what-are-veth-parirs>What are veth parirs?</h2><h2 id=what-is-a-bridge>What is a bridge?</h2></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/kubernetes>Kubernetes</a></li><li><a href=/tags/networking>Networking</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/zhengxinzx rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=mailto:xin.zheng.0459@outlook.com rel=me title=Mail><i data-feather=mail></i></a>
<a class=border></a></div><div class=footer-info>2024 Â© zhengxin |</div></footer><script>feather.replace()</script></div></body></html>